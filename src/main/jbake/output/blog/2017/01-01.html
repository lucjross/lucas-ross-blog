<!DOCTYPE html>
<html>
  <html>
    <head>
      <meta charset="utf-8">
      <title>Does it matter whether I return an empty collection or a null one?
      </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="description" content="Lucas's Programming Blog">
      <meta name="author" content="Lucas Ross">
      <meta name="keywords" content="">
      <meta name="generator" content="JBake">
      <!-- Le styles-->
      <link rel="stylesheet" href="../../css/bootstrap.min.css">
      <!--link(rel='stylesheet', href='#{content.rootpath}css/asciidoctor.css')-->
      <link rel="stylesheet" href="../../css/base.css">
      <!--link(rel='stylesheet', href='#{content.rootpath}css/prettify.css')-->
      <!-- HTML5 shim, for IE6-8 support of HTML5 elements-->
      <!-- if lt IE 9
      script(src='../../js/html5shiv.min.js')
      
      -->
      <!-- Fav icon-->
      <link rel="shortcut icon" href="../../favicon.ico">
      <!-- SyntaxHighlighter-->
      <link href="../../css/shCore.css" rel="stylesheet" type="text/css">
      <link href="../../css/shThemeDefault.css" rel="stylesheet" type="text/css">
    </head>
  </html>
  <body>
    <div id="wrap">
      <div role="navigation" class="navbar navbar-default navbar-fixed-top">
        <div class="container">
          <div class="navbar-header">
            <button type="button" data-toggle="collapse" data-target=".navbar-collapse" class="navbar-toggle"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a href="../../" class="navbar-brand">Lucas's Programming Blog</a>
          </div>
          <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
              <li><a href="../../index.html">Home</a></li>
              <li><a href="../../about.html">About</a></li>
              <li><a href="../../feed.xml">Subscribe</a></li>
              <!--li.dropdown-->
              <!--    a(href='#', class='dropdown-toggle', data-toggle='dropdown') Dropdown <b class="caret"></b>-->
              <!--    ul.dropdown-menu-->
              <!--        li-->
              <!--            a(href='#') Action-->
              <!--        li-->
              <!--            a(href='#') Another action-->
              <!--        li-->
              <!--            a(href='#') Something else here-->
              <!--        li.divider-->
              <!--        li.dropdown-header Nav header-->
              <!--        li-->
              <!--            a(href='#') Separated link-->
              <!--        li-->
              <!--            a(href='#') One more separated link-->
              
              
              
              
              
            </ul>
          </div>
        </div>
      </div>
      <div class="container">
        <div class="page-header">
          <h1>Does it matter whether I return an empty collection or a null one?</h1>
          <p><em>01 January 2017</em></p>
          <p>
<p>This is kind of a philosophical question. Is code A any better or worse than code B?</p>
<div class="panel panel-default">
    <div class="panel-heading">A</div>
    <div class="panel-body"><pre class="brush: java">
 Collection&lt;String&gt; words() {
     Collection&lt;Sentence&gt; sentences = dao.getSentences();
     if (sentences != null) {
         return sentences.stream().flatMap(sentence -&gt; sentence.getWords().stream())
             .collect(Collectors.toList());
     }
     else {
         return Collections.emptyList();
     }
 }
    </pre></div>
</div>
<div class="panel panel-default">
    <div class="panel-heading">B</div>
    <div class="panel-body"><pre class="brush: java">
 Optional&lt;Collection&lt;String&gt;&gt; words() {
     Collection&lt;Sentence&gt; sentences = dao.getSentences();
     if (sentences == null) {
         return Optional.empty();
     }
     else {
         return Optional.of(
             sentences.stream().flatMap(sentence -&gt; sentence.getWords().stream())
                 .collect(Collectors.toList()));
     }
 }
    </pre></div>
</div>

<p>In the absence of documentation, here is how I would interpret two methods like those.</p>
<table class="table">
    <tr>
        <th>Method</th>
        <th>What the method is expected to do</th>
        <th>What the method actually does</th>
        <th>What you get</th>
    </tr>
    <tr>
        <td>A</td>
        <td>Obtain some X and give you some Y based upon those X</td>
        <td>
            <p>If unable to obtain X, we'll just pretend that we did.</p>
            <p>Thereby, we can pretend that we know what Y exists, and arbitrarily provide some Y (zero of them, perhaps).
                No one will ever know the difference!</p>
        </td>
        <td>Some (zero) Y</td>
    </tr>
    <tr>
        <td>B</td>
        <td>Obtain some X and give you some Y based upon those X</td>
        <td>
            <p>If unable to obtain X, then we don't know what X exists. Some other source may know, but we don't.</p>
            <p>Therefore we don't know what Y exists either. We'll admit that we don't know, which may be a helpful signal to the user.</p>
        </td>
        <td>null or <code>Optional.empty()</code></td>
    </tr>
</table>

<p>You may notice that I'm biased on this issue, but either way, there is a difference.
    For a given scenario, how do you decide whether this matters?
    Basically, how do you know whether it's going to affect a user's (another developer's) experience?
    A few factors may be considered:</p>
<ul>
    <li>Is the method public or protected? If so, there's no telling how an imprecise return value can affect future development,
        so a developer should probably err on the side of returning (or throwing) an indicator of "missing information" as necessary.</li>
    <li>Is the method adapting to a legacy or third-party API? If so, there might be no choice but to accept "null" to mean
        "empty" or vice-versa.</li>
</ul>
<p>In any case, is it really necessary to force developers to ask these questions and have to solve mysteries about
    what a function result is supposed to mean? Providing a clear contract can make this a non-issue:</p>
<pre class="brush: java">
 /**
  * @return  a Collection containing all the Words in all the Sentences. If the Sentences are unknown,
  *          then an empty list will be returned.
  */
 @NotNull
 public Collection&lt;String&gt; words() { ...
</pre>

</p>
          <!--hr-->
        </div>
      </div>
    </div>
  </body>
  <div id="push"></div>
  <div id="footer">
    <div class="container">
      <p class="muted credit">&copy; 2016 | Mixed with<a href="http://getbootstrap.com/"> Bootstrap v3.1.1</a> | Baked with<a href="http://jbake.org"> JBake <span>v2.5.0</span></a><br>All product names, logos, and brands are property of their respective owners.
        All company, product and service names used in this website are for identification purposes only.
        Use of these names, logos, and brands does not imply endorsement.
      </p>
    </div>
  </div>
  <script src="../../js/jquery-1.11.1.min.js"></script>
  <script src="../../js/bootstrap.min.js"></script>
  <!--script(src='#{content.rootpath}js/prettify.js')-->
  <!-- SyntaxHighlighter-->
  <script type="text/javascript" src="../../js/shCore.js"></script>
  <script type="text/javascript" src="../../js/shBrushJava.js"></script>
  <script type="text/javascript" src="../../js/shBrushXml.js"></script>
  <script type="text/javascript">SyntaxHighlighter.all();</script>
</html>